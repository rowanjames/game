define(['app/base', 'angularjs', 'fbase'], function(MailerApp) {
  var SettingsController;
  SettingsController = (function() {
    function SettingsController($scope, FirebaseService, $rootScope) {
      var height1, height2;
      $scope.minHeight = 0;
      height1 = angular.element(document.getElementById('options-panel'))[0].offsetHeight;
      height2 = angular.element(document.getElementById('details-panel'))[0].offsetHeight;
      $scope.minHeight = height1 > height2 ? height1 + 'px' : height2 + 'px';
      $scope.activeTabs = {
        profile: true,
        settings: false,
        headerTxt: "Profile"
      };
      $rootScope.$watch('userBasic', function(newVal, oldVal) {
        if ($rootScope.userBasic) {
          return $scope.user = {
            firstName: $rootScope.userBasic.firstName,
            lastName: $rootScope.userBasic.lastName,
            profile: $rootScope.userBasic.profile
          };
        }
      });
      $scope.profileBox = function($event) {
        $event.preventDefault();
        return $scope.activeTabs = {
          profile: true,
          settings: false,
          headerTxt: "Profile"
        };
      };
      $scope.settingsBox = function($event) {
        $event.preventDefault();
        return $scope.activeTabs = {
          profile: false,
          settings: true,
          headerTxt: "Account Settings"
        };
      };
      $scope.updateProfile = function(theForm) {
        if (theForm.$valid) {
          $scope.savingProfile = true;
          $rootScope.currentUserRef.child('basic/firstName').set($scope.user.firstName);
          $rootScope.currentUserRef.child('basic/lastName').set($scope.user.lastName, function() {
            return $scope.$apply(function() {
              return $scope.savingProfile = false;
            });
          });
          if ($scope.user.profile) {
            return $rootScope.currentUserRef.child('basic/profile').set($scope.user.profile);
          }
        }
      };
      $scope.alertInfo = {};
      $scope.getObjLength = function(obj) {
        if (obj) {
          return Object.keys(obj).length;
        } else {
          return 0;
        }
      };
      $scope.updatePassword = function(pwdForm) {
        if (pwdForm.$valid) {
          $scope.alertInfo = {
            spinner: true,
            alert: false,
            alertMsg: ''
          };
          return $rootScope.rootRef.changePassword({
            email: $rootScope.userBasic.email,
            oldPassword: $scope.user.oldPassword,
            newPassword: $scope.user.newPassword
          }, function(error) {
            if (error) {
              switch (error.code) {
                case 'INVALID_PASSWORD':
                  $scope.$apply(function() {
                    return $scope.alertInfo = {
                      spinner: false,
                      alert: true,
                      alertMsg: 'The specified password is incorrect.'
                    };
                  });
                  break;
                case 'INVALID_USER':
                  $scope.$apply(function() {
                    return $scope.alertInfo = {
                      spinner: false,
                      alert: true,
                      alertMsg: 'The specified user account does not exist.'
                    };
                  });
                  break;
                default:
                  $scope.$apply(function() {
                    return $scope.alertInfo = {
                      spinner: false,
                      alert: true,
                      alertMsg: "Error changing password: " + error
                    };
                  });
              }
            } else {
              $scope.$apply(function() {
                return $scope.alertInfo = {
                  spinner: false,
                  alert: true,
                  alertMsg: 'User password changed successfully!'
                };
              });
            }
          });
        }
      };
      $scope.delAcc = function(delAccForm) {
        if (delAccForm.$valid) {
          $scope.alertDel = {
            spinner: true,
            alert: false,
            alertMsg: ''
          };
          console.log($rootScope.userBasic.email);
          console.log($scope.user.currentPwd);
          $scope.delAccMsg = true;
          $scope.delAlert = false;
          $scope.delMsg = null;
          return $rootScope.rootRef.removeUser({
            email: $rootScope.userBasic.email,
            password: $scope.user.currentPwd
          }, function(error) {
            console.log(error);
            if (error) {
              return $scope.$apply(function() {
                $scope.delAlert = true;
                $scope.delMsg = error.code;
                return $scope.delAccMsg = false;
              });
            } else {
              $scope.$apply(function() {
                $scope.delAccMsg = false;
                $scope.delAlert = false;
                return $scope.delMsg = null;
              });
              $rootScope.currentUserRef.set(null);
              $rootScope.child("secondaryIndexes/users/" + ($rootScope.currentUserRef.key())).set(null);
              return window.location.reload();
            }
          });
        }
      };
    }

    return SettingsController;

  })();
  SettingsController.$inject = ["$scope", "FirebaseService", "$rootScope"];
  MailerApp.controller('SettingsController', SettingsController);
  return SettingsController;
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL2tyaXNobmFyb2toYWxlL2NvZGUvbGV2ZWwvbGV2ZWwvcHJvamVjdHMvbW9zYWljZWQvcHVibGljL2phdmFzY3JpcHRzL2FwcC9jb250cm9sbGVycy9zZXR0aW5nc19jb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL1VzZXJzL2tyaXNobmFyb2toYWxlL2NvZGUvbGV2ZWwvbGV2ZWwvcHJvamVjdHMvbW9zYWljZWQvYXNzZXRzL2phdmFzY3JpcHRzL2FwcC9jb250cm9sbGVycy9zZXR0aW5nc19jb250cm9sbGVyLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxNQUFBLENBQU8sQ0FBRSxVQUFGLEVBQWEsV0FBYixFQUEwQixPQUExQixDQUFQLEVBQTBDLFNBQUMsU0FBRCxHQUFBO0FBRXhDLE1BQUEsa0JBQUE7QUFBQSxFQUFNO0FBRVMsSUFBQSw0QkFBQyxNQUFELEVBQVMsZUFBVCxFQUEwQixVQUExQixHQUFBO0FBQ1gsVUFBQSxnQkFBQTtBQUFBLE1BQUEsTUFBTSxDQUFDLFNBQVAsR0FBbUIsQ0FBbkIsQ0FBQTtBQUFBLE1BRUEsT0FBQSxHQUFVLE9BQU8sQ0FBQyxPQUFSLENBQWdCLFFBQVEsQ0FBQyxjQUFULENBQXlCLGVBQXpCLENBQWhCLENBQTBELENBQUEsQ0FBQSxDQUFFLENBQUMsWUFGdkUsQ0FBQTtBQUFBLE1BR0EsT0FBQSxHQUFVLE9BQU8sQ0FBQyxPQUFSLENBQWdCLFFBQVEsQ0FBQyxjQUFULENBQXlCLGVBQXpCLENBQWhCLENBQTBELENBQUEsQ0FBQSxDQUFFLENBQUMsWUFIdkUsQ0FBQTtBQUFBLE1BSUEsTUFBTSxDQUFDLFNBQVAsR0FBc0IsT0FBQSxHQUFVLE9BQWIsR0FBMEIsT0FBQSxHQUFXLElBQXJDLEdBQThDLE9BQUEsR0FBVyxJQUo1RSxDQUFBO0FBQUEsTUFNQSxNQUFNLENBQUMsVUFBUCxHQUFvQjtBQUFBLFFBQUMsT0FBQSxFQUFTLElBQVY7QUFBQSxRQUFnQixR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QUEsTUFBTSxDQUFDLFFBQVAsR0FBa0IsSUFBbEIsQ0FBQTtBQUFBLGdCQUNBLE1BQU0sQ0FBQyxNQUFQLEdBQWdCLEtBQUssQ0FBQyxJQUR0QixDQUFBO3VCQUVBLE1BQU0sQ0FBQyxTQUFQLEdBQW1CLE1BSFA7Y0FBQSxDQUFkLEVBREo7YUFBQSxNQUFBO0FBTUUsY0FBQSxNQUFNLENBQUMsTUFBUCxDQUFjLFNBQUEsR0FBQTtBQUNaLGdCQUFBLE1BQU0sQ0FBQyxTQUFQLEdBQW1CLEtBQW5CLENBQUE7QUFBQSxnQkFDQSxNQUFNLENBQUMsUUFBUCxHQUFrQixLQURsQixDQUFBO3VCQUVBLE1BQU0sQ0FBQyxNQUFQLEdBQWdCLEtBSEo7Y0FBQSxDQUFkLENBQUEsQ0FBQTtBQUFBLGNBSUEsVUFBVSxDQUFDLGNBQWMsQ0FBQyxHQUExQixDQUE4QixJQUE5QixDQUpBLENBQUE7QUFBQSxjQUtBLFVBQVUsQ0FBQyxLQUFYLENBQWtCLHlCQUFBLEdBQXdCLENBQUMsVUFBVSxDQUFDLGNBQWMsQ0FBQyxHQUExQixDQUFBLENBQUQsQ0FBMUMsQ0FBNkUsQ0FBQyxHQUE5RSxDQUFrRixJQUFsRixDQUxBLENBQUE7cUJBTUEsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFoQixDQUFBLEVBWkY7YUFGQztVQUFBLENBSEgsRUFWRjtTQURjO01BQUEsQ0F0RWhCLENBRFc7SUFBQSxDQUFiOzs4QkFBQTs7TUFGRixDQUFBO0FBQUEsRUE0R0Esa0JBQWtCLENBQUMsT0FBbkIsR0FBNkIsQ0FBRSxRQUFGLEVBQVksaUJBQVosRUFBK0IsWUFBL0IsQ0E1RzdCLENBQUE7QUFBQSxFQThHQSxTQUFTLENBQUMsVUFBVixDQUFzQixvQkFBdEIsRUFBMkMsa0JBQTNDLENBOUdBLENBQUE7U0FnSEEsbUJBbEh3QztBQUFBLENBQTFDLENBQUEsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImRlZmluZSBbJ2FwcC9iYXNlJywnYW5ndWxhcmpzJywgJ2ZiYXNlJ10sIChNYWlsZXJBcHApIC0+XG5cbiAgY2xhc3MgU2V0dGluZ3NDb250cm9sbGVyXG5cbiAgICBjb25zdHJ1Y3RvcjogKCRzY29wZSwgRmlyZWJhc2VTZXJ2aWNlLCAkcm9vdFNjb3BlKSAtPlxuICAgICAgJHNjb3BlLm1pbkhlaWdodCA9IDBcblxuICAgICAgaGVpZ2h0MSA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3B0aW9ucy1wYW5lbCcpKVswXS5vZmZzZXRIZWlnaHRcbiAgICAgIGhlaWdodDIgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbHMtcGFuZWwnKSlbMF0ub2Zmc2V0SGVpZ2h0XG4gICAgICAkc2NvcGUubWluSGVpZ2h0ID0gaWYgaGVpZ2h0MSA+IGhlaWdodDIgdGhlbiBoZWlnaHQxICsgJ3B4JyBlbHNlIGhlaWdodDIgKyAncHgnXG5cbiAgICAgICRzY29wZS5hY3RpdmVUYWJzID0ge3Byb2ZpbGU6IHRydWUsIHNldHRpbmdzOiBmYWxzZSwgaGVhZGVyVHh0OiBcIlByb2ZpbGVcIn1cblxuXG4gICAgICAkcm9vdFNjb3BlLiR3YXRjaCAndXNlckJhc2ljJywgKG5ld1ZhbCwgb2xkVmFsKSAtPlxuICAgICAgICBpZiAkcm9vdFNjb3BlLnVzZXJCYXNpY1xuICAgICAgICAgICRzY29wZS51c2VyID0ge2ZpcnN0TmFtZTogJHJvb3RTY29wZS51c2VyQmFzaWMuZmlyc3ROYW1lLCBsYXN0TmFtZTogJHJvb3RTY29wZS51c2VyQmFzaWMubGFzdE5hbWUsIHByb2ZpbGU6ICRyb290U2NvcGUudXNlckJhc2ljLnByb2ZpbGV9XG5cblxuXG4gICAgICAkc2NvcGUucHJvZmlsZUJveCA9ICgkZXZlbnQpIC0+XG4gICAgICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICRzY29wZS5hY3RpdmVUYWJzID0ge3Byb2ZpbGU6IHRydWUsIHNldHRpbmdzOiBmYWxzZSwgaGVhZGVyVHh0OiBcIlByb2ZpbGVcIn1cblxuXG4gICAgICAkc2NvcGUuc2V0dGluZ3NCb3ggPSAoJGV2ZW50KSAtPlxuICAgICAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgICAgICAkc2NvcGUuYWN0aXZlVGFicyA9IHtwcm9maWxlOiBmYWxzZSwgc2V0dGluZ3M6IHRydWUsIGhlYWRlclR4dDogXCJBY2NvdW50IFNldHRpbmdzXCJ9XG5cblxuICAgICAgJHNjb3BlLnVwZGF0ZVByb2ZpbGUgPSAodGhlRm9ybSkgLT5cbiAgICAgICAgaWYgdGhlRm9ybS4kdmFsaWRcbiAgICAgICAgICAkc2NvcGUuc2F2aW5nUHJvZmlsZSA9IHRydWVcbiAgICAgICAgICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyUmVmLmNoaWxkKCdiYXNpYy9maXJzdE5hbWUnKS5zZXQgJHNjb3BlLnVzZXIuZmlyc3ROYW1lXG4gICAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50VXNlclJlZi5jaGlsZCgnYmFzaWMvbGFzdE5hbWUnKS5zZXQgJHNjb3BlLnVzZXIubGFzdE5hbWUsICgpIC0+XG4gICAgICAgICAgICAkc2NvcGUuJGFwcGx5IC0+XG4gICAgICAgICAgICAgICRzY29wZS5zYXZpbmdQcm9maWxlID0gZmFsc2VcbiAgICAgICAgICAoJHJvb3RTY29wZS5jdXJyZW50VXNlclJlZi5jaGlsZCgnYmFzaWMvcHJvZmlsZScpLnNldCAkc2NvcGUudXNlci5wcm9maWxlKSBpZiAkc2NvcGUudXNlci5wcm9maWxlXG5cblxuXG4gICAgICAkc2NvcGUuYWxlcnRJbmZvID0ge31cblxuICAgICAgJHNjb3BlLmdldE9iakxlbmd0aCA9IChvYmopIC0+XG4gICAgICAgIGlmIG9ialxuICAgICAgICAgIE9iamVjdC5rZXlzKG9iaikubGVuZ3RoXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAwXG5cbiAgICAgICRzY29wZS51cGRhdGVQYXNzd29yZCA9IChwd2RGb3JtKSAtPlxuICAgICAgICBpZiBwd2RGb3JtLiR2YWxpZFxuICAgICAgICAgICRzY29wZS5hbGVydEluZm8gPSB7c3Bpbm5lcjogdHJ1ZSwgYWxlcnQ6IGZhbHNlLCBhbGVydE1zZzogJyd9XG5cbiAgICAgICAgICAkcm9vdFNjb3BlLnJvb3RSZWYuY2hhbmdlUGFzc3dvcmQge1xuICAgICAgICAgICAgZW1haWw6ICRyb290U2NvcGUudXNlckJhc2ljLmVtYWlsXG4gICAgICAgICAgICBvbGRQYXNzd29yZDogJHNjb3BlLnVzZXIub2xkUGFzc3dvcmRcbiAgICAgICAgICAgIG5ld1Bhc3N3b3JkOiAkc2NvcGUudXNlci5uZXdQYXNzd29yZFxuICAgICAgICAgIH0sIChlcnJvcikgLT5cbiAgICAgICAgICAgIGlmIGVycm9yXG4gICAgICAgICAgICAgIHN3aXRjaCBlcnJvci5jb2RlXG4gICAgICAgICAgICAgICAgd2hlbiAnSU5WQUxJRF9QQVNTV09SRCdcbiAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkgLT5cbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFsZXJ0SW5mbyA9IHtzcGlubmVyOiBmYWxzZSwgYWxlcnQ6IHRydWUsIGFsZXJ0TXNnOiAnVGhlIHNwZWNpZmllZCBwYXNzd29yZCBpcyBpbmNvcnJlY3QuJ31cbiAgICAgICAgICAgICAgICB3aGVuICdJTlZBTElEX1VTRVInXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5IC0+XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hbGVydEluZm8gPSB7c3Bpbm5lcjogZmFsc2UsIGFsZXJ0OiB0cnVlLCBhbGVydE1zZzogJ1RoZSBzcGVjaWZpZWQgdXNlciBhY2NvdW50IGRvZXMgbm90IGV4aXN0Lid9XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseSAtPlxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWxlcnRJbmZvID0ge3NwaW5uZXI6IGZhbHNlLCBhbGVydDogdHJ1ZSwgYWxlcnRNc2c6IFwiRXJyb3IgY2hhbmdpbmcgcGFzc3dvcmQ6ICN7ZXJyb3J9XCJ9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICRzY29wZS4kYXBwbHkgLT5cbiAgICAgICAgICAgICAgICAkc2NvcGUuYWxlcnRJbmZvID0ge3NwaW5uZXI6IGZhbHNlLCBhbGVydDogdHJ1ZSwgYWxlcnRNc2c6ICdVc2VyIHBhc3N3b3JkIGNoYW5nZWQgc3VjY2Vzc2Z1bGx5ISd9XG4gICAgICAgICAgICByZXR1cm5cblxuXG4gICAgICAkc2NvcGUuZGVsQWNjID0gKGRlbEFjY0Zvcm0pIC0+XG4gICAgICAgIGlmIGRlbEFjY0Zvcm0uJHZhbGlkXG4gICAgICAgICAgJHNjb3BlLmFsZXJ0RGVsID0ge3NwaW5uZXI6IHRydWUsIGFsZXJ0OiBmYWxzZSwgYWxlcnRNc2c6ICcnfVxuXG4gICAgICAgICAgY29uc29sZS5sb2cgJHJvb3RTY29wZS51c2VyQmFzaWMuZW1haWxcbiAgICAgICAgICBjb25zb2xlLmxvZyAkc2NvcGUudXNlci5jdXJyZW50UHdkXG5cbiAgICAgICAgICAkc2NvcGUuZGVsQWNjTXNnID0gdHJ1ZVxuICAgICAgICAgICRzY29wZS5kZWxBbGVydCA9IGZhbHNlXG4gICAgICAgICAgJHNjb3BlLmRlbE1zZyA9IG51bGxcblxuICAgICAgICAgICRyb290U2NvcGUucm9vdFJlZi5yZW1vdmVVc2VyIHtcbiAgICAgICAgICAgIGVtYWlsOiAkcm9vdFNjb3BlLnVzZXJCYXNpYy5lbWFpbFxuICAgICAgICAgICAgcGFzc3dvcmQ6ICRzY29wZS51c2VyLmN1cnJlbnRQd2RcbiAgICAgICAgICB9LCAoZXJyb3IpIC0+XG4gICAgICAgICAgICBjb25zb2xlLmxvZyBlcnJvclxuICAgICAgICAgICAgaWYgZXJyb3JcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5IC0+XG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGVsQWxlcnQgPSB0cnVlXG4gICAgICAgICAgICAgICAgICAkc2NvcGUuZGVsTXNnID0gZXJyb3IuY29kZVxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmRlbEFjY01zZyA9IGZhbHNlXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICRzY29wZS4kYXBwbHkgLT5cbiAgICAgICAgICAgICAgICAkc2NvcGUuZGVsQWNjTXNnID0gZmFsc2VcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGVsQWxlcnQgPSBmYWxzZVxuICAgICAgICAgICAgICAgICRzY29wZS5kZWxNc2cgPSBudWxsXG4gICAgICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXJSZWYuc2V0IG51bGxcbiAgICAgICAgICAgICAgJHJvb3RTY29wZS5jaGlsZChcInNlY29uZGFyeUluZGV4ZXMvdXNlcnMvI3skcm9vdFNjb3BlLmN1cnJlbnRVc2VyUmVmLmtleSgpfVwiKS5zZXQgbnVsbFxuICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKClcblxuXG5cblxuXG5cbiAgU2V0dGluZ3NDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCJGaXJlYmFzZVNlcnZpY2VcIiwgXCIkcm9vdFNjb3BlXCJdXG5cbiAgTWFpbGVyQXBwLmNvbnRyb2xsZXIgJ1NldHRpbmdzQ29udHJvbGxlcicsIFNldHRpbmdzQ29udHJvbGxlclxuXG4gIFNldHRpbmdzQ29udHJvbGxlciJdfQ==

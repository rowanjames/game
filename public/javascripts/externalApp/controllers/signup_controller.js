define(['externalApp/base', 'angularjs', 'fbase'], function(AngApp) {
  var SignupController;
  SignupController = (function() {
    function SignupController($scope, FirebaseService, $timeout, $firebaseArray) {
      if (FirebaseService.authData) {
        window.location = '/app';
      } else {
        $scope.user = {};
        $scope.alertInfo = {
          spinner: false,
          alert: false
        };
        $scope.batchesIndex = $firebaseArray(FirebaseService.rootRef.child("batches/index"));
        $scope.notifyEmail = null;
        $scope.validBatches = [];
        $scope.getLength = function(obj) {
          if (obj) {
            return Object.keys(obj).length;
          } else {
            return 0;
          }
        };
        $scope.batchesIndex.$loaded(function(x) {
          if (x) {
            return $timeout(function() {
              $scope.batchesIndexLoaded = true;
              angular.forEach($scope.batchesIndex, function(v, k) {
                if ($scope.getLength(v.students) < v.studentLimit) {
                  return $scope.validBatches.push($scope.batchesIndex[k]);
                }
              });
              return $scope.selectedBatch = $scope.validBatches[0];
            });
          }
        });
        $scope.changeBatch = function(batch) {
          return $scope.selectedBatch = batch;
        };
        $scope.getNotified = function(notifyEmail) {
          if (notifyEmail) {
            FirebaseService.rootRef.child("notifyEmails").push().set({
              email: notifyEmail
            });
            $scope.alertInfo = {
              showNotifyThanks: true
            };
            return $scope.notifyEmail = null;
          }
        };
        $scope.createNewUser = function(newUserForm) {
          var theEmail;
          if (newUserForm.$valid) {
            $scope.alertInfo = {
              spinner: true,
              alert: false
            };
            theEmail = $scope.user.email;
            return FirebaseService.rootRef.createUser({
              email: theEmail,
              password: $scope.user.password
            }, function(error, userData) {
              var usrRef;
              if (error) {
                console.log(error);
                switch (error.code) {
                  case 'EMAIL_TAKEN':
                    return $scope.$apply(function() {
                      return $scope.alertInfo = {
                        spinner: false,
                        alert: true,
                        alertMsg: "The email is already in use."
                      };
                    });
                  case 'INVALID_EMAIL':
                    return $scope.$apply(function() {
                      return $scope.alertInfo = {
                        spinner: false,
                        alert: true,
                        alertMsg: "The specified email is not a valid email."
                      };
                    });
                  default:
                    return $scope.$apply(function() {
                      return $scope.alertInfo = {
                        spinner: false,
                        alert: true,
                        alertMsg: "Error: " + error
                      };
                    });
                }
              } else {
                usrRef = FirebaseService.rootRef.child("users/" + userData.uid);
                usrRef.child('basic').set({
                  userType: 'student',
                  authData: userData,
                  firstName: $scope.user.firstName,
                  lastName: $scope.user.lastName,
                  email: theEmail,
                  createdAt: moment().unix()
                });
                usrRef.child("batches/index").push().set({
                  courseId: $scope.selectedBatch.courseId,
                  mentorId: $scope.selectedBatch.mentorId,
                  batchId: $scope.selectedBatch.$id
                });
                FirebaseService.rootRef.child("batches/" + $scope.selectedBatch.courseId + "/" + $scope.selectedBatch.mentorId + "/" + $scope.selectedBatch.$id + "/students/" + (usrRef.key())).set({
                  firstName: $scope.user.firstName,
                  lastName: $scope.user.lastName,
                  studentId: usrRef.key()
                });
                FirebaseService.rootRef.child("batches/index/" + $scope.selectedBatch.$id + "/students/" + (usrRef.key())).set({
                  firstName: $scope.user.firstName,
                  lastName: $scope.user.lastName,
                  studentId: usrRef.key()
                });
                usrRef.setPriority(theEmail);
                return FirebaseService.rootRef.authWithPassword({
                  'email': theEmail,
                  'password': $scope.user.password
                }, function(error, authData) {
                  if (error) {
                    console.log(error);
                    return $scope.alertInfo = {
                      spinner: false,
                      alert: true,
                      alertMsg: "Your account was created but there was a problem signing in. Please try to sign in again from the sign in page."
                    };
                  } else {
                    console.log('Authenticated successfully with payload:', authData);
                    FirebaseService.authData = authData;
                    return window.location = '/app';
                  }
                });
              }
            });
          }
        };
      }
    }

    return SignupController;

  })();
  SignupController.$inject = ["$scope", "FirebaseService", "$timeout", "$firebaseArray"];
  AngApp.controller('SignupController', SignupController);
  return SignupController;
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL2tyaXNobmFyb2toYWxlL2NvZGUvbGV2ZWwvbGV2ZWwvcHJvamVjdHMvbW9zYWljZWQvcHVibGljL2phdmFzY3JpcHRzL2V4dGVybmFsQXBwL2NvbnRyb2xsZXJzL3NpZ251cF9jb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL1VzZXJzL2tyaXNobmFyb2toYWxlL2NvZGUvbGV2ZWwvbGV2ZWwvcHJvamVjdHMvbW9zYWljZWQvYXNzZXRzL2phdmFzY3JpcHRzL2V4dGVybmFsQXBwL2NvbnRyb2xsZXJzL3NpZ251cF9jb250cm9sbGVyLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxNQUFBLENBQU8sQ0FBRSxrQkFBRixFQUFxQixXQUFyQixFQUFrQyxPQUFsQyxDQUFQLEVBQWtELFNBQUMsTUFBRCxHQUFBO0FBRWhELE1BQUEsZ0JBQUE7QUFBQSxFQUFNO0FBRVMsSUFBQSwwQkFBQyxNQUFELEVBQVMsZUFBVCxFQUEwQixRQUExQixFQUFvQyxjQUFwQyxHQUFBO0FBQ1gsTUFBQSxJQUFHLGVBQWUsQ0FBQyxRQUFuQjtBQUNFLFFBQUEsTUFBTSxDQUFDLFFBQVAsR0FBbUIsTUFBbkIsQ0FERjtPQUFBLE1BQUE7QUFJRSxRQUFBLE1BQU0sQ0FBQyxJQUFQLEdBQWMsRUFBZCxDQUFBO0FBQUEsUUFDQSxNQUFNLENBQUMsU0FBUCxHQUFtQjtBQUFBLFVBQUMsT0FBQSxFQUFTLEtBQVY7QUFBQSxVQUFpQixLQUFBLEVBQU8sS0FBeEI7U0FEbkIsQ0FBQTtBQUFBLFFBRUEsTUFBTSxDQUFDLFlBQVAsR0FBc0IsY0FBQSxDQUFlLGVBQWUsQ0FBQyxPQUFPLENBQUMsS0FBeEIsQ0FBK0IsZUFBL0IsQ0FBZixDQUZ0QixDQUFBO0FBQUEsUUFHQSxNQUFNLENBQUMsV0FBUCxHQUFxQixJQUhyQixDQUFBO0FBQUEsUUFJQSxNQUFNLENBQUMsWUFBUCxHQUFzQixFQUp0QixDQUFBO0FBQUEsUUFNQSxNQUFNLENBQUMs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QUFBLEVBQVEsUUFEOEI7QUFBQSxrQkFFdEMsVUFBQSxFQUFXLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFGZTtpQkFBekMsRUFHRyxTQUFDLEtBQUQsRUFBUSxRQUFSLEdBQUE7QUFDRCxrQkFBQSxJQUFHLEtBQUg7QUFDRSxvQkFBQSxPQUFPLENBQUMsR0FBUixDQUFZLEtBQVosQ0FBQSxDQUFBOzJCQUNBLE1BQU0sQ0FBQyxTQUFQLEdBQW1CO0FBQUEsc0JBQUMsT0FBQSxFQUFTLEtBQVY7QUFBQSxzQkFBaUIsS0FBQSxFQUFPLElBQXhCO0FBQUEsc0JBQThCLFFBQUEsRUFBVyxpSEFBekM7c0JBRnJCO21CQUFBLE1BQUE7QUFLRSxvQkFBQSxPQUFPLENBQUMsR0FBUixDQUFhLDBDQUFiLEVBQXdELFFBQXhELENBQUEsQ0FBQTtBQUFBLG9CQUNBLGVBQWUsQ0FBQyxRQUFoQixHQUEyQixRQUQzQixDQUFBOzJCQUVBLE1BQU0sQ0FBQyxRQUFQLEdBQW1CLE9BUHJCO21CQURDO2dCQUFBLENBSEgsRUE1QkY7ZUFEQztZQUFBLENBSEgsRUFKRjtXQURxQjtRQUFBLENBakN2QixDQUpGO09BRFc7SUFBQSxDQUFiOzs0QkFBQTs7TUFGRixDQUFBO0FBQUEsRUEyRkEsZ0JBQWdCLENBQUMsT0FBakIsR0FBMkIsQ0FBRSxRQUFGLEVBQVksaUJBQVosRUFBK0IsVUFBL0IsRUFBMkMsZ0JBQTNDLENBM0YzQixDQUFBO0FBQUEsRUE2RkEsTUFBTSxDQUFDLFVBQVAsQ0FBbUIsa0JBQW5CLEVBQXNDLGdCQUF0QyxDQTdGQSxDQUFBO1NBK0ZBLGlCQWpHZ0Q7QUFBQSxDQUFsRCxDQUFBLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJcbmRlZmluZSBbJ2V4dGVybmFsQXBwL2Jhc2UnLCdhbmd1bGFyanMnLCAnZmJhc2UnXSwgKEFuZ0FwcCkgLT5cblxuICBjbGFzcyBTaWdudXBDb250cm9sbGVyXG5cbiAgICBjb25zdHJ1Y3RvcjogKCRzY29wZSwgRmlyZWJhc2VTZXJ2aWNlLCAkdGltZW91dCwgJGZpcmViYXNlQXJyYXkpIC0+XG4gICAgICBpZiBGaXJlYmFzZVNlcnZpY2UuYXV0aERhdGFcbiAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJy9hcHAnXG4gICAgICBlbHNlXG5cbiAgICAgICAgJHNjb3BlLnVzZXIgPSB7fVxuICAgICAgICAkc2NvcGUuYWxlcnRJbmZvID0ge3NwaW5uZXI6IGZhbHNlLCBhbGVydDogZmFsc2V9XG4gICAgICAgICRzY29wZS5iYXRjaGVzSW5kZXggPSAkZmlyZWJhc2VBcnJheShGaXJlYmFzZVNlcnZpY2Uucm9vdFJlZi5jaGlsZChcImJhdGNoZXMvaW5kZXhcIikpXG4gICAgICAgICRzY29wZS5ub3RpZnlFbWFpbCA9IG51bGxcbiAgICAgICAgJHNjb3BlLnZhbGlkQmF0Y2hlcyA9IFtdXG5cbiAgICAgICAgJHNjb3BlLmdldExlbmd0aCA9IChvYmopIC0+XG4gICAgICAgICAgaWYgb2JqXG4gICAgICAgICAgICBPYmplY3Qua2V5cyhvYmopLmxlbmd0aFxuICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgIDAgIFxuXG4gICAgICAgICRzY29wZS5iYXRjaGVzSW5kZXguJGxvYWRlZCAoeCkgLT5cbiAgICAgICAgICBpZiB4XG4gICAgICAgICAgICAkdGltZW91dCAtPlxuICAgICAgICAgICAgICAkc2NvcGUuYmF0Y2hlc0luZGV4TG9hZGVkID0gdHJ1ZVxuICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2ggJHNjb3BlLmJhdGNoZXNJbmRleCwgKHYsaykgLT5cbiAgICAgICAgICAgICAgICBpZiAkc2NvcGUuZ2V0TGVuZ3RoKHYuc3R1ZGVudHMpIDwgdi5zdHVkZW50TGltaXRcbiAgICAgICAgICAgICAgICAgICRzY29wZS52YWxpZEJhdGNoZXMucHVzaCAkc2NvcGUuYmF0Y2hlc0luZGV4W2tdXG4gICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEJhdGNoID0gJHNjb3BlLnZhbGlkQmF0Y2hlc1swXVxuXG4gICAgICAgICRzY29wZS5jaGFuZ2VCYXRjaCA9IChiYXRjaCkgLT5cbiAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRCYXRjaCA9IGJhdGNoXG5cblxuICAgICAgICAkc2NvcGUuZ2V0Tm90aWZpZWQgPSAobm90aWZ5RW1haWwpIC0+XG4gICAgICAgICAgaWYgbm90aWZ5RW1haWxcbiAgICAgICAgICAgIEZpcmViYXNlU2VydmljZS5yb290UmVmLmNoaWxkKFwibm90aWZ5RW1haWxzXCIpLnB1c2goKS5zZXQge2VtYWlsOiBub3RpZnlFbWFpbH1cbiAgICAgICAgICAgICRzY29wZS5hbGVydEluZm8gPSB7c2hvd05vdGlmeVRoYW5rczogdHJ1ZX1cbiAgICAgICAgICAgICRzY29wZS5ub3RpZnlFbWFpbCA9IG51bGxcblxuXG5cbiAgICAgICAgJHNjb3BlLmNyZWF0ZU5ld1VzZXIgPSAobmV3VXNlckZvcm0pIC0+XG4gICAgICAgICAgaWYgbmV3VXNlckZvcm0uJHZhbGlkXG4gICAgICAgICAgICAkc2NvcGUuYWxlcnRJbmZvID0ge3NwaW5uZXI6IHRydWUsIGFsZXJ0OiBmYWxzZX1cbiAgICAgICAgICAgIHRoZUVtYWlsID0gJHNjb3BlLnVzZXIuZW1haWxcblxuICAgICAgICAgICAgRmlyZWJhc2VTZXJ2aWNlLnJvb3RSZWYuY3JlYXRlVXNlciB7XG4gICAgICAgICAgICAgIGVtYWlsOiB0aGVFbWFpbFxuICAgICAgICAgICAgICBwYXNzd29yZDogJHNjb3BlLnVzZXIucGFzc3dvcmRcbiAgICAgICAgICAgIH0sIChlcnJvciwgdXNlckRhdGEpIC0+XG4gICAgICAgICAgICAgIGlmIGVycm9yXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cgZXJyb3JcbiAgICAgICAgICAgICAgICBzd2l0Y2ggZXJyb3IuY29kZVxuICAgICAgICAgICAgICAgICAgd2hlbiAnRU1BSUxfVEFLRU4nXG5cbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseSAtPlxuICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hbGVydEluZm8gPSB7c3Bpbm5lcjogZmFsc2UsIGFsZXJ0OiB0cnVlLCBhbGVydE1zZzogXCJUaGUgZW1haWwgaXMgYWxyZWFkeSBpbiB1c2UuXCJ9XG5cbiAgICAgICAgICAgICAgICAgIHdoZW4gJ0lOVkFMSURfRU1BSUwnXG5cbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseSAtPlxuICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hbGVydEluZm8gPSB7c3Bpbm5lcjogZmFsc2UsIGFsZXJ0OiB0cnVlLCBhbGVydE1zZzogXCJUaGUgc3BlY2lmaWVkIGVtYWlsIGlzIG5vdCBhIHZhbGlkIGVtYWlsLlwifVxuXG4gICAgICAgICAgICAgICAgICBlbHNlXG5cbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseSAtPlxuICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hbGVydEluZm8gPSB7c3Bpbm5lcjogZmFsc2UsIGFsZXJ0OiB0cnVlLCBhbGVydE1zZzogXCJFcnJvcjogI3tlcnJvcn1cIn1cblxuICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdXNyUmVmID0gRmlyZWJhc2VTZXJ2aWNlLnJvb3RSZWYuY2hpbGQoXCJ1c2Vycy8je3VzZXJEYXRhLnVpZH1cIilcbiAgICAgICAgICAgICAgICB1c3JSZWYuY2hpbGQoJ2Jhc2ljJykuc2V0IHt1c2VyVHlwZTogJ3N0dWRlbnQnLGF1dGhEYXRhOiB1c2VyRGF0YSwgZmlyc3ROYW1lOiAkc2NvcGUudXNlci5maXJzdE5hbWUsIGxhc3ROYW1lOiAkc2NvcGUudXNlci5sYXN0TmFtZSwgZW1haWw6IHRoZUVtYWlsLCBjcmVhdGVkQXQ6IG1vbWVudCgpLnVuaXgoKX1cbiAgICAgICAgICAgICAgICB1c3JSZWYuY2hpbGQoXCJiYXRjaGVzL2luZGV4XCIpLnB1c2goKS5zZXQge2NvdXJzZUlkOiAkc2NvcGUuc2VsZWN0ZWRCYXRjaC5jb3Vyc2VJZCwgbWVudG9ySWQ6ICRzY29wZS5zZWxlY3RlZEJhdGNoLm1lbnRvcklkLCBiYXRjaElkOiAkc2NvcGUuc2VsZWN0ZWRCYXRjaC4kaWR9XG4gICAgICAgICAgICAgICAgRmlyZWJhc2VTZXJ2aWNlLnJvb3RSZWYuY2hpbGQoXCJiYXRjaGVzLyN7JHNjb3BlLnNlbGVjdGVkQmF0Y2guY291cnNlSWR9LyN7JHNjb3BlLnNlbGVjdGVkQmF0Y2gubWVudG9ySWR9LyN7JHNjb3BlLnNlbGVjdGVkQmF0Y2guJGlkfS9zdHVkZW50cy8je3VzclJlZi5rZXkoKX1cIikuc2V0IHtmaXJzdE5hbWU6ICRzY29wZS51c2VyLmZpcnN0TmFtZSwgbGFzdE5hbWU6ICRzY29wZS51c2VyLmxhc3ROYW1lLCBzdHVkZW50SWQ6IHVzclJlZi5rZXkoKX0gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgRmlyZWJhc2VTZXJ2aWNlLnJvb3RSZWYuY2hpbGQoXCJiYXRjaGVzL2luZGV4LyN7JHNjb3BlLnNlbGVjdGVkQmF0Y2guJGlkfS9zdHVkZW50cy8je3VzclJlZi5rZXkoKX1cIikuc2V0IHtmaXJzdE5hbWU6ICRzY29wZS51c2VyLmZpcnN0TmFtZSwgbGFzdE5hbWU6ICRzY29wZS51c2VyLmxhc3ROYW1lLCBzdHVkZW50SWQ6IHVzclJlZi5rZXkoKX0gICAgICAgICAgICAgICAgXG5cbiAgICAgICAgICAgICAgICB1c3JSZWYuc2V0UHJpb3JpdHkgdGhlRW1haWxcblxuXG4gICAgICAgICAgICAgICAgRmlyZWJhc2VTZXJ2aWNlLnJvb3RSZWYuYXV0aFdpdGhQYXNzd29yZCB7XG4gICAgICAgICAgICAgICAgICAnZW1haWwnOiB0aGVFbWFpbFxuICAgICAgICAgICAgICAgICAgJ3Bhc3N3b3JkJzogJHNjb3BlLnVzZXIucGFzc3dvcmRcbiAgICAgICAgICAgICAgICB9LCAoZXJyb3IsIGF1dGhEYXRhKSAtPlxuICAgICAgICAgICAgICAgICAgaWYgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cgZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFsZXJ0SW5mbyA9IHtzcGlubmVyOiBmYWxzZSwgYWxlcnQ6IHRydWUsIGFsZXJ0TXNnOiBcIllvdXIgYWNjb3VudCB3YXMgY3JlYXRlZCBidXQgdGhlcmUgd2FzIGEgcHJvYmxlbSBzaWduaW5nIGluLiBQbGVhc2UgdHJ5IHRvIHNpZ24gaW4gYWdhaW4gZnJvbSB0aGUgc2lnbiBpbiBwYWdlLlwifVxuXG4gICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nICdBdXRoZW50aWNhdGVkIHN1Y2Nlc3NmdWxseSB3aXRoIHBheWxvYWQ6JywgYXV0aERhdGFcbiAgICAgICAgICAgICAgICAgICAgRmlyZWJhc2VTZXJ2aWNlLmF1dGhEYXRhID0gYXV0aERhdGFcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJy9hcHAnXG5cblxuICBTaWdudXBDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCJGaXJlYmFzZVNlcnZpY2VcIiwgXCIkdGltZW91dFwiLCBcIiRmaXJlYmFzZUFycmF5XCJdXG5cbiAgQW5nQXBwLmNvbnRyb2xsZXIgJ1NpZ251cENvbnRyb2xsZXInLCBTaWdudXBDb250cm9sbGVyXG5cbiAgU2lnbnVwQ29udHJvbGxlciJdfQ==
